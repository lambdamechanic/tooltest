#!/usr/bin/env sh

set -u

if [ "${BR_BEADS_SYNC_MAINTENANCE:-}" = "1" ]; then
    exit 0
fi

if ! command -v br >/dev/null 2>&1; then
    echo "Error: br command not found in PATH; pre-commit requires br." >&2
    echo "  Install br or add it to your PATH before committing." >&2
    exit 1
fi

if ! br sync --flush-only; then
    echo "Error: br sync --flush-only failed; aborting commit." >&2
    exit 1
fi

if ! git diff --quiet -- .beads/issues.jsonl; then
    git add .beads/issues.jsonl
fi
